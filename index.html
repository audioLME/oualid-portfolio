<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Oualid Meghlaoui</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

    <!-- Background Lines Grid -->
    <div id="bg-lines"></div>
    <svg id="shape-overlay" style="position: fixed; inset: 0; pointer-events: none; z-index: 0;"></svg>
    <div id="bg-highlight"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay"></div>

    <!-- Version Indicator -->
    <div id="version-indicator">v0.0.00</div>

  <!-- HEADER -->
  <header class="site-header">
    <a href="/" class="logo"><span>O</span><span>U</span><span>A</span><span>L</span><span>I</span><span>D</span><span>&nbsp;</span><span>M</span><span>E</span><span>G</span><span>H</span><span>L</span><span>A</span><span>O</span><span>U</span><span>I</span></a>

    <nav class="nav">
      <a href="#">RESUME</a>
      <a href="#">PORTFOLIO</a>
      <a href="#">CONTACT</a>
    </nav>

    <div class="meta" id="time-display">Algeria&nbsp;&nbsp;&nbsp;<svg class="hourglass" width="12" height="15" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <polygon points="0,0 16,0 8,10" fill="#111"/>
  <polygon points="8,10 0,20 16,20" fill="#111"/>
</svg>&nbsp;&nbsp;&nbsp;00:00 AM&nbsp;&nbsp;&nbsp;Jan 1, 2026</div>
  </header>

  <!-- HERO -->
  <main class="hero">
    <div class="hero-words">
      <div id="animation-box"></div>
      <div id="subtitle-box"></div>
    </div>

    <section class="hero-text">
      <h1 id="hero-heading"></h1>
      <button id="continue-arrow" class="continue-btn">
        <span class="continue-text">CONTINUE</span>
        <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 3L3 3L3 8M16 3L21 3L21 8M21 16L21 21L16 21M3 16L3 21L8 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </section>
  </main>

  <!-- GSAP -->
  <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
  <script src="hero.js"></script>
  <script src="shapes.js"></script>
  <script>
    // Fetch version from Vercel deployments, fallback to GitHub
    async function updateVersion() {
      try {
        // Try Vercel API first
        const response = await fetch('/api/deployments');
        const data = await response.json();
        if (data.version) {
          document.getElementById('version-indicator').textContent = data.version;
          return;
        }
      } catch (error) {
        console.log('Vercel API failed, trying GitHub...');
      }

      // Fallback to GitHub commits
      try {
        const response = await fetch('https://api.github.com/repos/audiolME/oualid-portfolio/commits?per_page=1');
        const linkHeader = response.headers.get('Link');
        let commitCount = 1;
        
        if (linkHeader) {
          const match = linkHeader.match(/page=(\d+)>; rel="last"/);
          if (match) commitCount = parseInt(match[1]);
        }
        
        const minor = Math.floor(commitCount / 100);
        const patch = (commitCount % 100).toString().padStart(2, '0');
        const version = `v0.${minor}.${patch}`;
        
        document.getElementById('version-indicator').textContent = version;
      } catch (error) {
        console.log('Version fetch failed');
      }
    }
    updateVersion();

    function updateTime() {
      const now = new Date();
      const timeString = now.toLocaleString('en-US', {timeZone: 'Africa/Algiers', hour12: true, hour: 'numeric', minute: '2-digit'});
      const dateString = now.toLocaleString('en-US', {timeZone: 'Africa/Algiers', month: 'short', day: 'numeric', year: 'numeric'});
      document.getElementById('time-display').innerHTML = `Algeria\u00A0\u00A0\u00A0<svg class="hourglass" width="12" height="15" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <polygon points="0,0 16,0 8,10" fill="#111"/>
  <polygon points="8,10 0,20 16,20" fill="#111"/>
</svg>\u00A0\u00A0\u00A0${timeString}\u00A0\u00A0\u00A0${dateString}`;
    }
    updateTime();
    setInterval(updateTime, 60000);

    // Entry animation
    const entryTl = gsap.timeline();
    entryTl.to('#loading-overlay', { top: '100%', duration: 1, ease: 'power2.inOut' })
      .to({}, { duration: 0.8 }) // delay to show empty background
      .fromTo('.logo', { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5 })
      .fromTo('.nav a', { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5, stagger: 0.2 }, '-=0.3')
      .fromTo('.meta', { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5 }, '-=0.25')
      .call(() => {
        // Start logo flip after buttons
        const logoTl = gsap.timeline({ repeat: -1 });
        logoTl.to('.logo span', { rotationY: 180, duration: 0.5, stagger: 0.1 }, 0)
          .to('.logo span', { rotationY: 0, duration: 0.5, stagger: 0.1 }, 0.5)
          .to({}, { duration: 4 }, 1);
      })
      .to('#animation-box', { opacity: 1, duration: 0.5 }, '+=0.2')
      .fromTo('.letter', { y: 300, opacity: 0 }, { y: 0, opacity: 1, duration: 0.9, stagger: 0.08, ease: 'power4.out' })
      .to('#subtitle-box', { opacity: 1, duration: 0.3 }, '-=0.3')
      .call(() => {
        // Type in MEGHLAOUI after OUALID appears
        if (typeof showSubtitle === 'function') {
          showSubtitle();
        }
      })
      .to('.hero-text', { opacity: 1, duration: 0 }, '+=0.5')
      .call(() => {
        // Animate hero text letter by letter
        if (typeof animateHeroText === 'function') {
          animateHeroText();
        }
      }, null, '+=0.5')
      .to('.continue-btn', { opacity: 1, duration: 0.8, ease: 'power2.out' }, '+=4')
      .call(() => {
        // Start cycling after OUALID has been shown for 2.5s
        if (typeof startCycle === 'function') {
          gsap.delayedCall(2.5, startCycle);
        }
      });

    // GRID HIGHLIGHT SYSTEM - single element for hover and flip
    const highlight = document.getElementById('bg-highlight');
    let inactivityTimer;
    let isFlipping = false;
    let lastTouchX = 0;
    let lastTouchY = 0;

    function getGridSize() {
      return window.innerWidth <= 768 ? 50 : 80;
    }

    function updateHighlight(e) {
      const gridSize = getGridSize();
      const x = e.clientX;
      const y = e.clientY;
      const cellX = Math.floor(x / gridSize) * gridSize;
      const cellY = Math.floor(y / gridSize) * gridSize;

      highlight.style.setProperty('--hx', `${cellX}px`);
      highlight.style.setProperty('--hy', `${cellY}px`);
      
      if (!isFlipping) {
        highlight.style.opacity = '1';
      }

      // Reset inactivity timer
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
        if (!isFlipping) highlight.style.opacity = '0';
      }, 1000);
    }

    window.addEventListener('mousemove', updateHighlight);
    window.addEventListener('mouseleave', () => {
      clearTimeout(inactivityTimer);
      if (!isFlipping) highlight.style.opacity = '0';
    });

    // Track touch position
    document.addEventListener('touchstart', (e) => {
      const touch = e.touches[0];
      lastTouchX = touch.clientX;
      lastTouchY = touch.clientY;
    });

    // Click/touch to flip
    function flipCell_onClick(e) {
      if (isFlipping) return;
      
      const gridSize = getGridSize();
      let x, y;
      if (e.type === 'touchend') {
        x = lastTouchX;
        y = lastTouchY;
      } else {
        x = e.clientX;
        y = e.clientY;
      }
      
      const cellX = Math.floor(x / gridSize) * gridSize;
      const cellY = Math.floor(y / gridSize) * gridSize;
      
      isFlipping = true;
      
      // Position at click location and show
      highlight.style.setProperty('--hx', `${cellX}px`);
      highlight.style.setProperty('--hy', `${cellY}px`);
      highlight.style.opacity = '1';
      
      const tl = gsap.timeline();
      tl.to(highlight, {
        rotationY: 180,
        duration: 0.35,
        ease: 'power2.in',
        backgroundColor: 'rgba(17, 17, 17, 0.9)',
        borderColor: 'rgba(0, 0, 0, 0.9)',
        boxShadow: '0 0 14px rgba(0,0,0,0.4)'
      })
        .to(highlight, {
          rotationY: 0,
          duration: 0.35,
          ease: 'power2.out',
          backgroundColor: 'rgba(0, 0, 0, 0)',
          borderColor: 'rgba(0, 0, 0, 0.06)',
          boxShadow: '0 0 14px rgba(0,0,0,0.16)',
          onComplete: () => {
            isFlipping = false;
          }
        });
    }

    window.addEventListener('click', flipCell_onClick);
    document.addEventListener('touchend', flipCell_onClick);

    // Continue button expand animation
    document.getElementById('continue-arrow').addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent grid flip
      
      const btn = e.currentTarget;
      const rect = btn.getBoundingClientRect();
      
      // Create fullscreen overlay
      const overlay = document.createElement('div');
      overlay.style.cssText = `
        position: fixed;
        left: ${rect.left}px;
        top: ${rect.top}px;
        width: ${rect.width}px;
        height: ${rect.height}px;
        background: #111;
        border-radius: 4px;
        z-index: 9999;
        pointer-events: none;
      `;
      document.body.appendChild(overlay);
      
      // Animate expansion
      gsap.to(overlay, {
        left: 0,
        top: 0,
        width: '100vw',
        height: '100vh',
        borderRadius: 0,
        duration: 1,
        ease: 'ease',
         onComplete: () => {
           // Navigate to profile page or trigger next section
           window.location.href = 'profile.html';
        }
      });
      
      // Fade out button
      gsap.to(btn, {
        opacity: 0,
        duration: 0.6,
        ease: 'ease'
      });
    });
  </script>
</body>
</html>
